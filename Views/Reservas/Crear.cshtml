@model ProyectoDistri2.Models.Reserva

@{
    ViewBag.Title = "Crear Reserva";
}

<div class="form-card">
    <h2>Crear Reserva</h2>

    @using (Html.BeginForm("Crear", "Reservas", FormMethod.Post, new { id = "formReserva" }))
    {
        @Html.HiddenFor(m => m.EspacioId)

        <div class="form-group">
            <label>Fecha Inicio</label>
            @Html.TextBoxFor(m => m.FechaInicio, "{0:yyyy-MM-ddTHH:mm}",
                new { @class = "form-control", type = "datetime-local", required = "required" })
        </div>

        <div class="form-group">
            <label>Fecha Fin</label>
            @Html.TextBoxFor(m => m.FechaFin, "{0:yyyy-MM-ddTHH:mm}",
                new { @class = "form-control", type = "datetime-local", required = "required" })
        </div>

        <button type="submit" class="btn btn-success mt-2">Guardar Reserva</button>
        @Html.ActionLink("Volver a Espacios", "Index", null, new { @class = "btn btn-secondary mt-2 ms-2" })

        <!-- 🔹 Alerta dinámica con icono -->
        <div id="alertaResultado" class="alert-dinamica" style="display:none;">
            <div class="icono-alerta"></div>
            <span class="mensaje-alerta"></span>
        </div>
    }
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            $("#formReserva").submit(function (e) {
                e.preventDefault();

                $.ajax({
                    url: this.action,
                    type: "POST",
                    data: $(this).serialize(),
                    success: function (resp) {
                        mostrarAlerta(resp.success, resp.message);
                    },
                    error: function () {
                        mostrarAlerta(false, "Error inesperado al intentar guardar la reserva.");
                    }
                });
            });

            function mostrarAlerta(exito, mensaje) {
                const alerta = $("#alertaResultado");
                const icono = alerta.find(".icono-alerta");
                const texto = alerta.find(".mensaje-alerta");

                alerta.removeClass("exito error").hide();
                icono.removeClass("icono-exito icono-error");

                if (exito) {
                    alerta.addClass("exito");
                    icono.addClass("icono-exito");
                } else {
                    alerta.addClass("error");
                    icono.addClass("icono-error");
                }

                texto.text(mensaje);

                alerta.slideDown(300).fadeIn(200);
                setTimeout(() => alerta.slideUp(300).fadeOut(200), 5000);
            }
        });
    </script>
}

@section styles {
    <link rel="stylesheet" href="~/Content/UsuarioCrear.css" />
}
