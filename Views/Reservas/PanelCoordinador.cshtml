<!-- *****************************************************
Proyecto 2 - Reserva.co
Vista PanelCoordinador.cshtml
Kenneth Andrés Pantoja Manobanda
Santiago Pila
Fecha: 03/08/2025

// RESULTADOS FINALES
- Se implementó interfaz de usuario para coordinadores
- Se integró gestión de reservas pendientes
- Se implementó sistema de alertas dinámicas
- Se estableció comunicación con API de reservas
- Se centralizó la gestión de espacios

// CONCLUSIONES
1. La interfaz proporciona una gestión eficiente de reservas pendientes
2. El sistema de alertas mejora la experiencia del usuario
3. La integración con la API permite operaciones seguras
4. La organización por pestañas facilita la navegación
5. El manejo de sesiones asegura la seguridad de las operaciones

************************************************* -->

@model List<ProyectoDistri2.Models.Reserva>
@{
    ViewBag.Title = "Panel Coordinador";
    var espacios = ViewBag.Espacios as List<ProyectoDistri2.Models.Espacio>;
}

<h2>Panel de Coordinador</h2>


<div class="tab-content mt-3">
    <!-- Reservas Pendientes -->
    <div class="tab-pane fade show active" id="reservas" role="tabpanel">
        <table class="table-modern">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Usuario</th>
                    <th>Espacio</th>
                    <th>Fecha Inicio</th>
                    <th>Fecha Fin</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var r in Model)
                {
                    <tr>
                        <td>@r.Id</td>
                        <td>@(r.Usuario?.Nombre)</td>
                        <td>@(r.Espacio?.Nombre) (@(r.Espacio?.Tipo))</td>
                        <td>@r.FechaInicio.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@r.FechaFin.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>
                            <button class="btn btn-success btn-sm" onclick="aprobarReserva(@r.Id)">Aprobar</button>
                            <button class="btn btn-danger btn-sm" onclick="rechazarReserva(@r.Id)">Rechazar</button>
                        </td>
                    </tr>
                }
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted">No hay reservas pendientes</td>
                    </tr>
                }
            </tbody>
        </table>

        <div id="alertaResultado" class="alert-dinamica mt-3"></div>
    </div>

    <!-- Lista de Espacios -->
    <div class="tab-pane fade" id="espacios" role="tabpanel">
        <table class="table-modern">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Tipo</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var e in espacios)
                {
                    <tr>
                        <td>@e.Id</td>
                        <td>@e.Nombre</td>
                        <td>@e.Tipo</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section scripts {
    <script>
function mostrarAlerta(exito, mensaje) {
    const alerta = $("#alertaResultado");
    alerta.removeClass("exito error").hide();

    if (exito) {
        alerta.addClass("exito").text("✅ " + mensaje);
    } else {
        alerta.addClass("error").text("⚠️ " + mensaje);
    }

    alerta.fadeIn().delay(3000).fadeOut();
}

function aprobarReserva(id) {
    $.ajax({
        url: 'https://localhost:44398/api/reservas/aprobar/' + id,
        type: 'PUT',
        headers: { 'Authorization': 'Bearer @Session["Token"]' },
        success: function() {
            mostrarAlerta(true, "Reserva aprobada correctamente");
            setTimeout(() => location.reload(), 1500);
        },
        error: function() {
            mostrarAlerta(false, "Error al aprobar la reserva, ya existe una reserva existente para este espacio y horario");
        }
    });
}

function rechazarReserva(id) {
    $.ajax({
        url: 'https://localhost:44398/api/reservas/rechazar/' + id,
        type: 'PUT',
        headers: { 'Authorization': 'Bearer @Session["Token"]' },
        success: function() {
            mostrarAlerta(true, "Reserva rechazada correctamente");
            setTimeout(() => location.reload(), 1500);
        },
        error: function() {
            mostrarAlerta(false, "Error al rechazar la reserva");
        }
    });
}
    </script>
}

@section styles {
    <link rel="stylesheet" href="~/Content/PanelCoordinador.css" />
}
